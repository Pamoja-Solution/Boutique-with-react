import{r as o,j as e,m as _,$ as ee}from"./app-AVqBGxCH.js";import{A as se}from"./AuthenticatedLayout-DyhD3eM0.js";import{c as x}from"./index-BCjI43bD.js";import"./Dropdown-jp6uszBQ.js";import"./Actif-CtmBXqQy.js";function ae({produit:j,rayons:w,stocks:D,onClose:i}){var l;const[c,u]=o.useState({type:"entree",quantity:1,rayon_id:(l=w[0])==null?void 0:l.id,motif:""}),b=n=>{n.preventDefault(),_.post("/stock-mouvements",{produit_id:j.id,...c},{onSuccess:()=>{var M;_.reload({only:["stocks"]}),u({type:"entree",quantity:1,rayon_id:(M=w[0])==null?void 0:M.id,motif:""})}})};return e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box max-w-4xl",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4",children:["Gestion de stock: ",j.nom]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-3",children:"Ajouter un mouvement"}),e.jsx("form",{onSubmit:b,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Type de mouvement*"})}),e.jsxs("select",{value:c.type,onChange:n=>u({...c,type:n.target.value}),className:"select select-bordered w-full",required:!0,children:[e.jsx("option",{value:"entree",children:"Entrée"}),e.jsx("option",{value:"sortie",children:"Sortie"}),e.jsx("option",{value:"ajustement",children:"Ajustement"}),e.jsx("option",{value:"transfert",children:"Transfert"})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Rayon*"})}),e.jsx("select",{value:c.rayon_id,onChange:n=>u({...c,rayon_id:n.target.value}),className:"select select-bordered w-full",required:!0,children:w.map(n=>e.jsxs("option",{value:n.id,children:[n.nom," (",n.code_emplacement,")"]},n.id))})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité*"})}),e.jsx("input",{type:"number",min:"1",value:c.quantity,onChange:n=>u({...c,quantity:n.target.value}),className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Motif"})}),e.jsx("textarea",{value:c.motif,onChange:n=>u({...c,motif:n.target.value}),className:"textarea textarea-bordered",rows:"2"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:i,className:"btn",children:"Annuler"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Enregistrer"})]})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-3",children:"Stock par rayon"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Rayon"}),e.jsx("th",{children:"Quantité"}),e.jsx("th",{children:"Alerte"})]})}),e.jsx("tbody",{children:D.map(n=>e.jsxs("tr",{children:[e.jsxs("td",{children:[n.rayon.nom," (",n.rayon.code_emplacement,")"]}),e.jsx("td",{children:e.jsx("span",{className:`font-bold ${n.quantite<=0?"text-error":n.quantite<=n.quantite_alerte?"text-warning":"text-success"}`,children:n.quantite})}),e.jsx("td",{children:n.quantite_alerte})]},n.id))})]})})]})]})]})})}function le({produit:j,prixProduits:w,onClose:D}){var L,N,y;const[i,c]=o.useState(null),[u,b]=o.useState(!1),[l,n]=o.useState(null),M=t=>{t.preventDefault();const d=new FormData(t.target);i?_.post(`/prix-produits/${i.id}`,{_method:"PUT",...Object.fromEntries(d)},{onSuccess:()=>{x.success("Prix modifié avec succès !"),c(null)},onError:p=>{Object.values(p).forEach(f=>x.error(f))}}):(d.append("produit_id",j.id),_.post("/prix-produits",Object.fromEntries(d),{onSuccess:()=>{x.success("Prix créé avec succès !"),c(null)},onError:p=>{Object.values(p).forEach(f=>x.error(f))}}))},k=t=>{n(t),b(!0)},P=()=>{_.delete(`/prix-produits/${l}`,{onSuccess:()=>{x.success("Prix supprimé avec succès !"),b(!1)},onError:()=>x.error("Erreur lors de la suppression.")})},F=()=>{var p,f;const t=parseFloat(((p=document.getElementById("edit_prix_detail"))==null?void 0:p.value)||0),d=parseFloat(((f=document.getElementById("edit_prix_achat"))==null?void 0:f.value)||0);if(!isNaN(t)&&!isNaN(d)){const h=t-d,E=d>0?(h/d*100).toFixed(2):0;return{marge:h,pourcentage:E}}return{marge:0,pourcentage:0}},v=[...w].sort((t,d)=>new Date(d.date_effet)-new Date(t.date_effet));return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:[e.jsxs("div",{className:"bg-base-100 rounded-box shadow-xl w-full max-w-5xl max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Historique des prix - ",j.nom]}),e.jsx("button",{onClick:D,className:"btn btn-sm btn-circle",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow",children:[i?e.jsxs("form",{onSubmit:M,className:"bg-base-200 p-4 rounded-box mb-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Modifier le prix"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Prix d'achat*"})}),e.jsx("input",{id:"edit_prix_achat",type:"number",step:"0.01",name:"prix_achat",defaultValue:i.prix_achat,className:"input input-bordered w-full",required:!0,onChange:()=>{const{marge:t,pourcentage:d}=F();document.getElementById("edit_marge_calc").textContent=`Marge: ${t.toLocaleString("fr-FR")} CDF (${d}%)`}})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Prix de vente détail*"})}),e.jsx("input",{id:"edit_prix_detail",type:"number",step:"0.01",name:"prix_detail",defaultValue:i.prix_detail,className:"input input-bordered w-full",required:!0,onChange:()=>{const{marge:t,pourcentage:d}=F();document.getElementById("edit_marge_calc").textContent=`Marge: ${t.toLocaleString("fr-FR")} CDF (${d}%)`}})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"text-sm text-info font-medium",id:"edit_marge_calc",children:["Marge: ",(i.prix_detail-i.prix_achat).toLocaleString("fr-FR")," CDF (",i.prix_achat>0?((i.prix_detail-i.prix_achat)/i.prix_achat*100).toFixed(2):0,"%)"]})}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité semi-gros*"})}),e.jsx("input",{type:"number",name:"quantite_semi_gros",defaultValue:i.quantite_semi_gros,className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Prix semi-gros*"})}),e.jsx("input",{type:"number",step:"0.01",name:"prix_semi_gros",defaultValue:i.prix_semi_gros,className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité gros*"})}),e.jsx("input",{type:"number",name:"quantite_gros",defaultValue:i.quantite_gros,className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Prix gros*"})}),e.jsx("input",{type:"number",step:"0.01",name:"prix_gros",defaultValue:i.prix_gros,className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Date d'effet*"})}),e.jsx("input",{type:"date",name:"date_effet",defaultValue:i.date_effet.substring(0,10),className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Date de fin"})}),e.jsx("input",{type:"date",name:"date_fin",defaultValue:(L=i.date_fin)==null?void 0:L.substring(0,10),className:"input input-bordered w-full"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{type:"button",onClick:()=>c(null),className:"btn btn-ghost",children:"Annuler"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Enregistrer"})]})]}):e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>{c({produit_id:j.id,prix_detail:"",prix_achat:"",quantite_semi_gros:4,prix_semi_gros:"",quantite_gros:10,prix_gros:"",date_effet:new Date().toISOString().split("T")[0]})},className:"btn btn-primary",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z",clipRule:"evenodd"})}),"Nouveau prix"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date d'effet"}),e.jsx("th",{children:"Date de fin"}),e.jsx("th",{children:"Prix détail"}),e.jsxs("th",{children:["Semi-gros (min ",((N=v[0])==null?void 0:N.quantite_semi_gros)||"?",")"]}),e.jsxs("th",{children:["Gros (min ",((y=v[0])==null?void 0:y.quantite_gros)||"?",")"]}),e.jsx("th",{children:"Prix achat"}),e.jsx("th",{children:"Marge"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[v.map(t=>{const d=new Date(t.date_effet).toLocaleDateString("fr-FR"),p=t.date_fin?new Date(t.date_fin).toLocaleDateString("fr-FR"):"En cours",f=t.prix_achat>0?(t.marge/t.prix_achat*100).toFixed(2):0;return e.jsxs("tr",{className:"hover",children:[e.jsx("td",{children:d}),e.jsx("td",{children:p}),e.jsxs("td",{children:[t.prix_detail.toLocaleString("fr-FR")," CDF"]}),e.jsxs("td",{children:[t.prix_semi_gros.toLocaleString("fr-FR")," CDF"]}),e.jsxs("td",{children:[t.prix_gros.toLocaleString("fr-FR")," CDF"]}),e.jsxs("td",{children:[t.prix_achat.toLocaleString("fr-FR")," CDF"]}),e.jsx("td",{children:e.jsxs("div",{className:"tooltip","data-tip":`${f}%`,children:[t.marge.toLocaleString("fr-FR")," CDF"]})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(t),className:"btn btn-xs btn-ghost",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>k(t.id),className:"btn btn-xs btn-ghost text-error",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},t.id)}),v.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-4",children:"Aucun prix défini pour ce produit"})})]})]})})]}),e.jsx("div",{className:"p-4 border-t",children:e.jsx("button",{onClick:D,className:"btn btn-primary",children:"Fermer"})})]}),u&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Confirmation"}),e.jsx("p",{children:"Voulez-vous vraiment supprimer ce prix ?"}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{className:"btn",onClick:()=>b(!1),children:"Annuler"}),e.jsx("button",{className:"btn btn-error",onClick:P,children:"Confirmer"})]})]})})]})}function oe({auth:j,produits:w,categories:D,rayons:i,prixProduits:c,stocks:u,flash:b}){const[l,n]=o.useState(null),[M,k]=o.useState(!1),[P,F]=o.useState(null),[v,L]=o.useState(""),[N,y]=o.useState(1),[t,d]=o.useState(10),[p,f]=o.useState("liste"),[h,E]=o.useState(null),[Q,$]=o.useState(!1),[G,R]=o.useState(!1),[te,H]=o.useState(null),[C,T]=o.useState({prix_detail:"",prix_achat:"",quantite_semi_gros:4,prix_semi_gros:"",quantite_gros:10,prix_gros:"",date_effet:new Date().toISOString().split("T")[0]});o.useEffect(()=>{b.success&&x.success(b.success),b.error&&x.error(b.error)},[b]);const W=s=>{s.preventDefault();const a=new FormData(s.target);l?_.post(`/produits/${l.id}`,{_method:"PUT",...Object.fromEntries(a)},{onSuccess:()=>{x.success("Produit modifié avec succès !"),document.getElementById("produit_modal").close()},onError:r=>{Object.values(r).forEach(m=>x.error(m))}}):_.post("/produits",a,{onSuccess:()=>{x.success("Produit créé avec succès !"),document.getElementById("produit_modal").close()},onError:r=>{Object.values(r).forEach(m=>x.error(m))}})},U=s=>{s.preventDefault();const a=new FormData(s.target);_.post("/prix-produits",Object.fromEntries(a),{onSuccess:()=>{x.success("Prix créé avec succès !"),document.getElementById("prix_modal").close()},onError:r=>{Object.values(r).forEach(m=>x.error(m))}})},J=s=>{F(s),k(!0)},K=()=>{_.delete(`/produits/${P}`,{onSuccess:()=>{x.success("Produit supprimé avec succès !"),k(!1)},onError:()=>x.error("Erreur lors de la suppression.")})},V=w.filter(s=>{var a;return s.code.toLowerCase().includes(v.toLowerCase())||s.nom.toLowerCase().includes(v.toLowerCase())||((a=s.categorie)==null?void 0:a.name.toLowerCase().includes(v.toLowerCase()))}),O=N*t,X=O-t,Y=V.slice(X,O),S=Math.ceil(V.length/t),Z=s=>{E(s);const a=c.filter(r=>r.produit_id===s.id).sort((r,m)=>new Date(m.date_effet)-new Date(r.date_effet))[0];T(a?{prix_detail:a.prix_detail,prix_achat:a.prix_achat,quantite_semi_gros:a.quantite_semi_gros,prix_semi_gros:a.prix_semi_gros,quantite_gros:a.quantite_gros,prix_gros:a.prix_gros,date_effet:new Date().toISOString().split("T")[0]}:{prix_detail:"",prix_achat:"",quantite_semi_gros:4,prix_semi_gros:"",quantite_gros:10,prix_gros:"",date_effet:new Date().toISOString().split("T")[0]}),document.getElementById("prix_modal").showModal()},A=s=>{E(s),R(!0)},z=()=>{var r,m;const s=parseFloat(((r=document.getElementById("prix_detail"))==null?void 0:r.value)||0),a=parseFloat(((m=document.getElementById("prix_achat"))==null?void 0:m.value)||0);if(!isNaN(s)&&!isNaN(a)){const q=s-a,I=a>0?(q/a*100).toFixed(2):0;return{marge:q,pourcentage:I}}return{marge:0,pourcentage:0}};return e.jsxs(se,{user:j.user,flash:b,children:[e.jsx(ee,{title:"Gestion des produits"}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Gestion des produits"}),e.jsx("div",{className:"flex gap-2",children:j.user.role=="admin"&&e.jsxs("button",{onClick:()=>{n(null),document.getElementById("produit_modal").showModal()},className:"btn btn-primary",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z",clipRule:"evenodd"})}),"Nouveau produit"]})})]}),e.jsxs("div",{className:"tabs tabs-boxed mb-6",children:[e.jsx("button",{className:`tab ${p==="liste"?"tab-active":""}`,onClick:()=>f("liste"),children:"Liste des produits"}),e.jsx("button",{className:`tab ${p==="alertes"?"tab-active":""}`,onClick:()=>f("alertes"),children:"Alertes de stock"})]}),p==="liste"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("div",{className:"join w-full",children:e.jsxs("label",{className:"input",children:[e.jsx("svg",{className:"h-[1em] opacity-50",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsxs("g",{strokeLinejoin:"round",strokeLinecap:"round",strokeWidth:"2.5",fill:"none",stroke:"currentColor",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]})}),e.jsx("input",{type:"text",placeholder:"Rechercher...",className:"input",value:v,onChange:s=>{L(s.target.value),y(1)}})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[V.length," produits trouvés"]}),e.jsxs("select",{className:"select select-bordered ",value:t,onChange:s=>{d(Number(s.target.value)),y(1)},children:[e.jsx("option",{value:10,children:"10/page"}),e.jsx("option",{value:25,children:"25/page"}),e.jsx("option",{value:50,children:"50/page"}),e.jsx("option",{value:100,children:"100/page"})]})]})]}),e.jsx("div",{className:"bg-base-100 rounded-box shadow over mb-8",children:e.jsx("div",{className:"",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Catégorie"}),e.jsx("th",{children:"Prix"}),e.jsx("th",{children:"Stock"}),e.jsx("th",{children:"Statut"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:Y.map(s=>{var m,q,I;const a=c.filter(g=>g.produit_id===s.id).sort((g,B)=>new Date(B.date_effet)-new Date(g.date_effet))[0],r=u.filter(g=>g.produit_id===s.id).reduce((g,B)=>g+B.quantite,0);return e.jsxs("tr",{className:"hover",children:[e.jsx("td",{children:s.code}),e.jsx("td",{children:s.nom}),e.jsx("td",{children:(m=s.categorie)==null?void 0:m.name}),e.jsx("td",{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:a?a.prix_detail.toLocaleString("fr-FR")+" CDF":"Non défini"}),a&&e.jsxs("span",{className:"text-xs opacity-70",children:["Marge: ",a.marge.toLocaleString("fr-FR")," CDF"]})]})}),e.jsxs("td",{children:[j.user.role==="admin"&&e.jsxs("button",{onClick:()=>A(s),className:`badge ${r<=0?"badge-error":r<=(((q=u.find(g=>g.produit_id===s.id))==null?void 0:q.quantite_alerte)||10)?"badge-warning":"badge-success"}`,children:[r," unités"]}),j.user.role!="admin"&&e.jsxs("button",{className:`badge ${r<=0?"badge-error":r<=(((I=u.find(g=>g.produit_id===s.id))==null?void 0:I.quantite_alerte)||10)?"badge-warning":"badge-success"}`,children:[r," unités"]})]}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.actif?"badge-success":"badge-error"}`,children:s.actif?"Actif":"Inactif"})}),e.jsx("td",{children:j.user.role==="admin"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"relative dropdown dropdown-end",children:e.jsxs("details",{className:"dropdown",children:[e.jsx("summary",{className:"btn btn-sm btn-ghost",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"})})}),e.jsxs("ul",{className:"absolute p-2 shadow menu dropdown-content z-[50] bg-base-100 rounded-box w-52 mt-1",children:["                                                                ",e.jsx("li",{children:e.jsx("button",{onClick:()=>{n(s),document.getElementById("produit_modal").showModal(),H(null)},children:"✏️ Modifier produit"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>Z(s),children:"💰 Gérer les prix"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>A(s),children:"📦 Gérer le stock"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>J(s.id),className:"text-error",children:"🗑️ Supprimer"})})]})]})})})})]},s.id)})})]})})}),S>1&&e.jsx("div",{className:"flex justify-center my-4",children:e.jsxs("div",{className:"join",children:[e.jsx("button",{className:"join-item btn",onClick:()=>y(s=>Math.max(1,s-1)),disabled:N===1,children:"«"}),Array.from({length:Math.min(5,S)},(s,a)=>{let r;return S<=5||N<=3?r=a+1:N>=S-2?r=S-4+a:r=N-2+a,e.jsx("button",{className:`join-item btn ${N===r?"btn-active":""}`,onClick:()=>y(r),children:r},r)}),e.jsx("button",{className:"join-item btn",onClick:()=>y(s=>Math.min(S,s+1)),disabled:N===S,children:"»"})]})})]}),p==="alertes"&&e.jsx("div",{className:"bg-base-100 rounded-box shadow overflow-hidden mb-8",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Catégorie"}),e.jsx("th",{children:"Stock"}),e.jsx("th",{children:"Seuil d'alerte"}),e.jsx("th",{children:"Rayon"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[u.filter(s=>s.quantite<=s.quantite_alerte).map(s=>{var r,m;const a=w.find(q=>q.id===s.produit_id);return a?e.jsxs("tr",{className:"hover",children:[e.jsx("td",{children:a.code}),e.jsx("td",{children:a.nom}),e.jsx("td",{children:(r=a.categorie)==null?void 0:r.name}),e.jsx("td",{children:e.jsxs("span",{className:`badge ${s.quantite<=0?"badge-error":"badge-warning"}`,children:[s.quantite," unités"]})}),e.jsxs("td",{children:[s.quantite_alerte," unités"]}),e.jsx("td",{children:(m=s.rayon)==null?void 0:m.nom}),e.jsx("td",{children:e.jsx("button",{onClick:()=>A(a),className:"btn btn-sm btn-primary",children:"Gérer"})})]},`${s.produit_id}-${s.rayon_id}`):null}),u.filter(s=>s.quantite<=s.quantite_alerte).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-4",children:"Aucune alerte de stock à afficher"})})]})]})})}),M&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Confirmation"}),e.jsx("p",{children:"Voulez-vous vraiment supprimer ce produit ?"}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{className:"btn",onClick:()=>k(!1),children:"Annuler"}),e.jsx("button",{className:"btn btn-error",onClick:K,children:"Confirmer"})]})]})}),e.jsxs("dialog",{id:"produit_modal",className:"modal",children:[e.jsxs("div",{className:"modal-box max-w-4xl",children:[e.jsx("h3",{className:"font-bold text-lg",children:l?"Modifier le produit":"Nouveau produit"}),e.jsx("div",{className:"divider"}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Code produit*"})}),e.jsx("input",{type:"text",name:"code",defaultValue:l==null?void 0:l.code,className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Nom*"})}),e.jsx("input",{type:"text",name:"nom",defaultValue:l==null?void 0:l.nom,className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Catégorie*"})}),e.jsxs("select",{name:"categorie_id",defaultValue:l==null?void 0:l.categorie_id,className:"select select-bordered w-full",required:!0,children:[e.jsx("option",{disabled:!0,value:"",children:"Sélectionnez..."}),D.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx("div",{className:"form-control",children:e.jsxs("label",{className:"label cursor-pointer",children:[e.jsx("span",{className:"label-text",children:"TVA applicable"}),e.jsx("input",{type:"checkbox",name:"tva_applicable",defaultChecked:(l==null?void 0:l.tva_applicable)??!0,className:"toggle toggle-primary"})]})}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Taux TVA (%)"})}),e.jsx("input",{type:"number",step:"0.01",name:"taux_tva",defaultValue:l==null?void 0:l.taux_tva,className:"input input-bordered w-full"})]}),e.jsx("div",{className:"form-control",children:e.jsxs("label",{className:"label cursor-pointer",children:[e.jsx("span",{className:"label-text",children:"Statut"}),e.jsx("input",{type:"checkbox",name:"actif",defaultChecked:(l==null?void 0:l.actif)??!0,className:"toggle toggle-primary"})]})}),e.jsxs("div",{className:"form-control md:col-span-2",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Description"})}),e.jsx("textarea",{name:"description",defaultValue:l==null?void 0:l.description,className:"textarea textarea-bordered h-24 w-full"})]}),e.jsxs("div",{className:"form-control md:col-span-2",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Image"})}),e.jsx("input",{type:"file",name:"image",className:"file-input file-input-bordered w-full"}),(l==null?void 0:l.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:`/storage/${l.image}`,alt:l.nom,className:"h-20 object-cover rounded-box"})})]})]}),!l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"divider",children:"Informations initiales de prix (optionnel)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Prix d'achat"})}),e.jsx("input",{type:"number",step:"0.01",name:"prix_achat",className:"input input-bordered w-full"})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Prix de vente détail"})}),e.jsx("input",{type:"number",step:"0.01",name:"prix_detail",className:"input input-bordered w-full"})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité semi-gros"})}),e.jsx("input",{type:"number",name:"quantite_semi_gros",defaultValue:"4",className:"input input-bordered w-full"})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Prix semi-gros"})}),e.jsx("input",{type:"number",step:"0.01",name:"prix_semi_gros",className:"input input-bordered w-full"})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité gros"})}),e.jsx("input",{type:"number",name:"quantite_gros",defaultValue:"10",className:"input input-bordered w-full"})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Prix gros"})}),e.jsx("input",{type:"number",step:"0.01",name:"prix_gros",className:"input input-bordered w-full"})]})]}),e.jsx("div",{className:"divider",children:"Stock initial (optionnel)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Rayon"})}),e.jsxs("select",{name:"rayon_id",className:"select select-bordered w-full",children:[e.jsx("option",{disabled:!0,value:"",children:"Sélectionnez..."}),i.map(s=>e.jsx("option",{value:s.id,children:s.nom},s.id))]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité initiale"})}),e.jsx("input",{type:"number",name:"stock_initial",className:"input input-bordered w-full"})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Seuil d'alerte"})}),e.jsx("input",{type:"number",name:"quantite_alerte",defaultValue:"10",className:"input input-bordered w-full"})]})]})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"button",onClick:()=>document.getElementById("produit_modal").close(),className:"btn btn-ghost",children:"Annuler"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:l?"Modifier":"Créer"})]})]})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:()=>document.getElementById("produit_modal").close(),children:"close"})})]}),e.jsxs("dialog",{id:"prix_modal",className:"modal",children:[e.jsxs("div",{className:"modal-box max-w-3xl",children:[e.jsxs("h3",{className:"font-bold text-lg",children:["Gestion des prix - ",h==null?void 0:h.nom]}),e.jsx("div",{className:"divider"}),e.jsxs("form",{onSubmit:U,children:[e.jsx("input",{type:"hidden",name:"produit_id",value:h==null?void 0:h.id}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Prix d'achat*"})}),e.jsx("input",{id:"prix_achat",type:"number",step:"0.01",name:"prix_achat",defaultValue:C.prix_achat,className:"input input-bordered w-full",required:!0,onChange:()=>{const{marge:s,pourcentage:a}=z();document.getElementById("marge_calc").textContent=`Marge: ${s.toLocaleString("fr-FR")} CDF (${a}%)`}})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Prix de vente détail*"})}),e.jsx("input",{id:"prix_detail",type:"number",step:"0.01",name:"prix_detail",defaultValue:C.prix_detail,className:"input input-bordered w-full",required:!0,onChange:()=>{const{marge:s,pourcentage:a}=z();document.getElementById("marge_calc").textContent=`Marge: ${s.toLocaleString("fr-FR")} CDF (${a}%)`}})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx("div",{className:"text-sm text-info font-medium",id:"marge_calc",children:"Marge: 0 CDF (0%)"})}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité semi-gros*"})}),e.jsx("input",{type:"number",name:"quantite_semi_gros",defaultValue:C.quantite_semi_gros,className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Prix semi-gros*"})}),e.jsx("input",{type:"number",step:"0.01",name:"prix_semi_gros",defaultValue:C.prix_semi_gros,className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité gros*"})}),e.jsx("input",{type:"number",name:"quantite_gros",defaultValue:C.quantite_gros,className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Prix gros*"})}),e.jsx("input",{type:"number",step:"0.01",name:"prix_gros",defaultValue:C.prix_gros,className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Date d'effet*"})}),e.jsx("input",{type:"date",name:"date_effet",defaultValue:C.date_effet,className:"input input-bordered w-full",required:!0})]})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"button",onClick:()=>document.getElementById("prix_modal").close(),className:"btn btn-ghost",children:"Annuler"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Enregistrer"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{document.getElementById("prix_modal").close(),E(h),$(!0)},children:"Historique complet"})]})]})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:()=>document.getElementById("prix_modal").close(),children:"close"})})]}),Q&&e.jsx(le,{produit:h,prixProduits:c.filter(s=>s.produit_id===h.id),onClose:()=>$(!1)}),G&&e.jsx(ae,{produit:h,rayons:i,stocks:u.filter(s=>s.produit_id===h.id),onClose:()=>R(!1)})]})]})}export{oe as default};
