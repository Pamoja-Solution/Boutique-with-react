import{q as g,r as l,v as S,j as e,$ as q}from"./app-BGCwe7YQ.js";import{A as w}from"./AuthenticatedLayout-iZMU9qq1.js";import{V as o}from"./index-BWb_JfMf.js";import"./Dropdown-CwZ0mvGO.js";import"./Actif-CCAzDc6_.js";function Q({produit:d,stocks:c,produits:m,rayons:h}){const{flash:n}=g().props,[u,f]=l.useState(d||null),[E,C]=l.useState([]),[k,$]=l.useState([]),{data:t,setData:i,post:_,processing:x,errors:A,reset:b}=S({produit_id:(u==null?void 0:u.id)||"",rayon_source_id:"",rayon_destination_id:"",quantite:1,motif:""});l.useEffect(()=>{n.error&&o.error(n.error),n.success&&o.success(n.success)},[n]),l.useEffect(()=>{t.produit_id&&t.rayon_source_id&&(c.find(a=>a.produit_id==t.produit_id&&a.rayon_id==t.rayon_source_id)||(o.error("Aucun stock disponible pour ce produit dans le rayon source sélectionné"),i("quantite",1)))},[t.produit_id,t.rayon_source_id]);const y=s=>{if(s.preventDefault(),t.rayon_source_id===t.rayon_destination_id){o.error("Les rayons source et destination doivent être différents");return}_(route("stock.transfert"),{preserveScroll:!0,onSuccess:()=>b(),onError:a=>{Object.values(a).forEach(r=>{o.error(r)})}})},N=s=>{const a=m.find(r=>r.id===parseInt(s));f(a||null),i({produit_id:s,rayon_source_id:"",rayon_destination_id:"",quantite:1,motif:""})},v=s=>`${s.produit_id}-${s.rayon_id}-${s.quantite}`;return e.jsxs(w,{children:[e.jsx(q,{title:"Gestion des stocks"}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Transfert de stock"}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Produit"})}),e.jsxs("select",{className:"select  select-primary",value:t.produit_id,onChange:s=>N(s.target.value),disabled:!!d,required:!0,children:[e.jsx("option",{value:"",children:"Sélectionnez un produit"}),(d?[d]:m).map(s=>e.jsx("option",{value:s.id,children:s.nom},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Rayon source"})}),e.jsxs("select",{className:"select select-bordered",value:t.rayon_source_id,onChange:s=>i("rayon_source_id",s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Sélectionnez un rayon"}),h.map(s=>{const a=c.find(r=>r.produit_id==t.produit_id&&r.rayon_id==s.id);return a?e.jsxs("option",{value:s.id,children:[s.nom," (Stock: ",a.quantite,")"]},s.id):null}).filter(Boolean)]})]}),e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Rayon destination"})}),e.jsxs("select",{className:"select select-bordered",value:t.rayon_destination_id,onChange:s=>i("rayon_destination_id",s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Sélectionnez un rayon"}),h.filter(s=>s.id!=t.rayon_source_id).map(s=>e.jsx("option",{value:s.id,children:s.nom},s.id))]})]})]}),e.jsxs("div",{className:"form-control w-full mt-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité"})}),e.jsx("input",{type:"number",min:"1",className:"input input-bordered w-full",value:t.quantite,onChange:s=>{const a=c.find(p=>p.produit_id==t.produit_id&&p.rayon_id==t.rayon_source_id),r=a?a.quantite:1,j=Math.min(parseInt(s.target.value)||0,r);i("quantite",j>0?j:1)},required:!0})]}),e.jsxs("div",{className:"form-control w-full mt-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Motif (optionnel)"})}),e.jsx("textarea",{className:"textarea textarea-bordered h-24",placeholder:"Motif du transfert",value:t.motif,onChange:s=>i("motif",s.target.value)})]}),e.jsx("div",{className:"card-actions justify-end mt-6",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:x||!t.produit_id||!t.rayon_source_id||!t.rayon_destination_id,children:x?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-spinner"}),"Transfert en cours..."]}):"Effectuer le transfert"})})]})]})}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Stocks disponibles"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Produit"}),e.jsx("th",{children:"Rayon"}),e.jsx("th",{className:"text-right",children:"Quantité"}),e.jsx("th",{className:"text-right",children:"Alerte"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.produit.nom}),e.jsx("td",{children:s.rayon.nom}),e.jsx("td",{className:"text-right",children:e.jsx("span",{className:s.quantite<=s.quantite_alerte?"text-error font-bold":"",children:s.quantite})}),e.jsx("td",{className:"text-right",children:s.quantite_alerte})]},v(s)))})]})})]})})]})})]})}export{Q as default};
