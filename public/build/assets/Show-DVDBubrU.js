import{r as n,q as D,j as e,$ as R,Y as F,m as u}from"./app-CFD2f151.js";import{A as P}from"./AuthenticatedLayout-Ddn20-Xk.js";import{c as x}from"./index-B9tAU3jH.js";import{F as B}from"./ArrowLeftIcon-BJp8SD23.js";import{F as M}from"./PlusIcon-CrP050uM.js";import{f as L}from"./format-Fr-isxMl.js";import{f as Q}from"./fr-CVdFLKdr.js";import"./Actif-BSdadqrY.js";function V({title:c,titleId:l,...d},m){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":l},d),c?n.createElement("title",{id:l},c):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))}const _=n.forwardRef(V);function J({auth:c,inventaire:l,produits:d,rayons:m}){var h,j,b,p,N,f,g,v;const{flash:T}=D().props,[a,i]=n.useState(null),[o,q]=n.useState(""),[C,E]=n.useState(d);n.useEffect(()=>{if(a){const s=document.getElementById("edit_item_modal");s&&s.showModal()}},[a]),n.useEffect(()=>{E(d.filter(s=>s.nom.toLowerCase().includes(o.toLowerCase())||s.code.toLowerCase().includes(o.toLowerCase())))},[o,d]);const I=s=>{s.preventDefault();const r=new FormData(s.target);u.post(`/inventaires/${l.id}/items`,r,{onSuccess:()=>{x.success("Produit ajouté à l'inventaire"),document.getElementById("add_item_modal").close(),s.target.reset()}})},S=s=>{s.preventDefault();const r=new FormData(s.target);u.post(`/inventaires/${l.id}/items/${a.id}`,{_method:"PUT",...Object.fromEntries(r)},{onSuccess:()=>{x.success("Quantité mise à jour"),document.getElementById("edit_item_modal").close(),i(null)}})},k=s=>{confirm("Êtes-vous sûr de vouloir retirer ce produit de l'inventaire?")&&u.delete(`/inventaires/${l.id}/items/${s}`,{onSuccess:()=>{x.success("Produit retiré de l'inventaire")}})},$=s=>{try{return L(new Date(s),"dd MMMM yyyy",{locale:Q})}catch{return s}},A=s=>{switch(s){case"planifie":return e.jsx("span",{className:"badge badge-info",children:"Planifié"});case"encours":return e.jsx("span",{className:"badge badge-warning",children:"En cours"});case"termine":return e.jsx("span",{className:"badge badge-success",children:"Terminé"});case"annule":return e.jsx("span",{className:"badge badge-error",children:"Annulé"});default:return e.jsx("span",{className:"badge badge-ghost",children:s})}},t=["planifie","encours"].includes(l.statut);return e.jsxs(P,{user:c.user,children:[e.jsx(R,{title:`Inventaire ${l.reference}`}),e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center mb-6 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{href:route("inventaires.index"),className:"btn btn-ghost",children:e.jsx(B,{className:"h-5 w-5"})}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Inventaire ",l.reference]}),A(l.statut)]}),t&&e.jsxs("button",{onClick:()=>document.getElementById("add_item_modal").showModal(),className:"btn btn-primary",children:[e.jsx(M,{className:"h-5 w-5 mr-1"}),"Ajouter un produit"]})]}),e.jsx("div",{className:"bg-base-100 rounded-box shadow-lg p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Détails"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",$(l.date_inventaire)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",l.statut]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Créé par:"})," ",((h=l.user)==null?void 0:h.name)||"Inconnu"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Sommaire"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Produits inventoriés:"})," ",((j=l.items)==null?void 0:j.length)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Écart total:"})," ",((b=l.items)==null?void 0:b.reduce((s,r)=>s+(r.ecart||0),0))||0]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Notes"}),e.jsx("p",{children:l.notes||"Aucune note"})]})]})}),(p=l.items)!=null&&p.length?e.jsx("div",{className:"bg-base-100 rounded-box shadow-lg overflow-hidden mb-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Produit"}),e.jsx("th",{children:"Rayon"}),e.jsx("th",{children:"Théorique"}),e.jsx("th",{children:"Réelle"}),e.jsx("th",{children:"Écart"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:l.items.map(s=>{var r,w,y;return e.jsxs("tr",{className:"hover",children:[e.jsx("td",{children:(r=s.produit)==null?void 0:r.code}),e.jsx("td",{children:(w=s.produit)==null?void 0:w.nom}),e.jsx("td",{children:(y=s.rayon)==null?void 0:y.nom}),e.jsx("td",{children:s.quantite_theorique}),e.jsx("td",{className:t?"font-bold text-primary":"",children:s.quantite_reelle}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.ecart>0?"badge-error":s.ecart<0?"badge-warning":"badge-success"}`,children:s.ecart})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[t&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>i(s),className:"btn btn-sm btn-ghost",children:"Quantité"}),e.jsx("button",{onClick:()=>k(s.id),className:"btn btn-sm btn-error",children:"Retirer"})]}),!t&&e.jsxs("button",{onClick:()=>i(s),className:"btn btn-sm btn-ghost",children:[e.jsx(_,{className:"h-4 w-4"}),"Détails"]})]})})]},s.id)})})]})})}):e.jsxs("div",{className:"alert alert-info",children:[e.jsx(_,{className:"h-6 w-6"}),e.jsx("span",{children:"Aucun produit n'a encore été ajouté à cet inventaire."})]}),e.jsxs("dialog",{id:"add_item_modal",className:"modal",children:[e.jsxs("div",{className:"modal-box max-w-3xl",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Ajouter un produit à l'inventaire"}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"form-control mb-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Rechercher un produit"})}),e.jsx("input",{type:"text",value:o,onChange:s=>q(s.target.value),placeholder:"Nom ou code du produit...",className:"input input-bordered w-full"})]}),e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"form-control mb-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Produit*"})}),e.jsxs("select",{name:"produit_id",className:"select select-bordered w-full",required:!0,children:[e.jsx("option",{value:"",children:"Sélectionnez un produit"}),C.map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.nom]},s.id))]})]}),e.jsxs("div",{className:"form-control mb-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Rayon*"})}),e.jsxs("select",{name:"rayon_id",className:"select select-bordered w-full",required:!0,children:[e.jsx("option",{value:"",children:"Sélectionnez un rayon"}),m.map(s=>e.jsxs("option",{value:s.id,children:[s.code_emplacement," - ",s.nom]},s.id))]})]}),e.jsxs("div",{className:"form-control mb-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité théorique*"})}),e.jsx("input",{type:"number",name:"quantite_theorique",min:"0",defaultValue:"0",className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control mb-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité réelle*"})}),e.jsx("input",{type:"number",name:"quantite_reelle",min:"0",defaultValue:"0",className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control mb-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Commentaire"})}),e.jsx("textarea",{name:"commentaire",className:"textarea textarea-bordered h-24"})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"button",onClick:()=>document.getElementById("add_item_modal").close(),className:"btn btn-ghost",children:"Annuler"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Ajouter"})]})]})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{children:"close"})})]}),a&&e.jsxs("dialog",{id:"edit_item_modal",className:"modal",children:[e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:t?`Modifier la quantité de ${(N=a.produit)==null?void 0:N.nom}`:`Détails du produit ${(f=a.produit)==null?void 0:f.nom}`}),e.jsx("div",{className:"divider"}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"form-control mb-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Produit"})}),e.jsx("input",{type:"text",value:(g=a.produit)==null?void 0:g.nom,className:"input input-bordered w-full",disabled:!0})]}),e.jsxs("div",{className:"form-control mb-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Rayon"})}),e.jsx("input",{type:"text",value:(v=a.rayon)==null?void 0:v.nom,className:"input input-bordered w-full",disabled:!0})]}),e.jsxs("div",{className:"form-control mb-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité théorique"})}),e.jsx("input",{type:"number",name:"quantite_theorique",defaultValue:a.quantite_theorique,className:"input input-bordered w-full",disabled:!t,required:!0})]}),e.jsxs("div",{className:"form-control mb-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantité réelle"})}),e.jsx("input",{type:"number",name:"quantite_reelle",defaultValue:a.quantite_reelle,min:"0",className:"input input-bordered w-full",disabled:!t,required:!0})]}),e.jsxs("div",{className:"form-control mb-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Commentaire"})}),e.jsx("textarea",{name:"commentaire",defaultValue:a.commentaire||"",className:"textarea textarea-bordered h-24",disabled:!t})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"button",onClick:()=>{document.getElementById("edit_item_modal").close(),i(null)},className:"btn btn-ghost",children:t?"Annuler":"Fermer"}),t&&e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Enregistrer"})]})]})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:()=>i(null),children:"close"})})]})]})]})}export{J as default};
