import{r as t,q as k,j as e,$ as E,Y as C,m}from"./app-DQtaLJuZ.js";import{A as _}from"./AuthenticatedLayout-NW5HXpru.js";import{c as u}from"./index-Be5G0uEU.js";import{F as S}from"./PlusIcon-7zhevjp9.js";import{F as D,a as I}from"./TrashIcon-Daf_x-pe.js";import{f as R}from"./format-Fr-isxMl.js";import{f as M}from"./fr-CVdFLKdr.js";import"./Actif-B1rKgxX-.js";function $({title:l,titleId:n,...a},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":n},a),l?t.createElement("title",{id:n},l):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"}))}const A=t.forwardRef($);function F({title:l,titleId:n,...a},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":n},a),l?t.createElement("title",{id:n},l):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const B=t.forwardRef(F);function L({title:l,titleId:n,...a},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":n},a),l?t.createElement("title",{id:n},l):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0 1 18 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3 1.5 1.5 3-3.75"}))}const V=t.forwardRef(L);function O({title:l,titleId:n,...a},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":n},a),l?t.createElement("title",{id:n},l):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const T=t.forwardRef(O);function U({auth:l,inventaires:n,stats:a}){var f;const{flash:r}=k().props,[c,d]=t.useState(null),[p,h]=t.useState(!1),[o,j]=t.useState(null);t.useEffect(()=>{if(c){const s=document.getElementById("edit_modal");s&&s.showModal()}},[c]);const b=(s,i)=>{s.preventDefault();const N=new FormData(s.target);i?m.post(`/inventaires/${c.id}`,{_method:"PUT",...Object.fromEntries(N)},{onSuccess:()=>{u.success("Inventaire modifié avec succès"),document.getElementById("edit_modal").close(),d(null)}}):m.post("/inventaires",N,{onSuccess:()=>{u.success("Inventaire créé avec succès"),document.getElementById("create_modal").close()}})},v=s=>{j(s),h(!0)},g=()=>{m.delete(`/inventaires/${o.id}`,{onSuccess:()=>{u.success("Inventaire supprimé avec succès"),h(!1),j(null)}})},x=(s,i)=>{m.post(`/inventaires/${s.id}/status`,{statut:i},{onSuccess:()=>{u.success(`Statut changé en "${i}"`)}})},w=s=>{switch(s){case"planifie":return e.jsx("span",{className:"badge badge-info",children:"Planifié"});case"encours":return e.jsx("span",{className:"badge badge-warning",children:"En cours"});case"termine":return e.jsx("span",{className:"badge badge-success",children:"Terminé"});case"annule":return e.jsx("span",{className:"badge badge-error",children:"Annulé"});default:return e.jsx("span",{className:"badge badge-ghost",children:s})}},y=s=>{try{return R(new Date(s),"dd MMM yyyy",{locale:M})}catch{return s}};return e.jsxs(_,{user:l.user.user,children:[e.jsx(E,{title:"Gestion des inventaires"}),e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Gestion des inventaires"}),l.user.role==="admin"&&e.jsxs("button",{onClick:()=>document.getElementById("create_modal").showModal(),className:"btn btn-primary",children:[e.jsx(S,{className:"h-5 w-5 mr-1"}),"Nouvel inventaire"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"stats shadow-lg",children:e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:"Total inventaires"}),e.jsx("div",{className:"stat-value",children:(a==null?void 0:a.total_inventaires)||0})]})}),e.jsx("div",{className:"stats shadow-lg",children:e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:"Inventaires terminés"}),e.jsx("div",{className:"stat-value",children:(a==null?void 0:a.inventaires_termines)||0})]})}),e.jsx("div",{className:"stats shadow-lg",children:e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:"En cours"}),e.jsx("div",{className:"stat-value",children:(a==null?void 0:a.inventaires_encours)||0})]})}),e.jsx("div",{className:"stats shadow-lg",children:e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:"Écart cumulé"}),e.jsx("div",{className:"stat-value text-warning",children:(a==null?void 0:a.ecart_total)||0}),e.jsx("div",{className:"stat-desc",children:"produits"})]})})]}),e.jsx("div",{className:"bg-base-100 rounded-box shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Référence"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Statut"}),e.jsx("th",{children:"Produits"}),e.jsx("th",{children:"Écart"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[n.map(s=>e.jsxs("tr",{className:"hover",children:[e.jsx("td",{children:s.reference}),e.jsx("td",{children:y(s.date_inventaire)}),e.jsx("td",{children:w(s.statut)}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-primary",children:s.items_count||0})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.ecart_total>0?"badge-error":s.ecart_total<0?"badge-warning":"badge-success"}`,children:s.ecart_total||0})}),e.jsx("td",{children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(C,{href:`/inventaires/${s.id}`,className:"btn btn-sm btn-primary",children:[e.jsx(V,{className:"h-4 w-4"}),"Détails"]}),s.statut==="planifie"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>x(s,"encours"),className:"btn btn-sm btn-warning",children:[e.jsx(A,{className:"h-4 w-4"}),"Débuter"]}),e.jsxs("button",{onClick:()=>d(s),className:"btn btn-sm btn-ghost",children:[e.jsx(D,{className:"h-4 w-4"}),"Modifier"]}),e.jsxs("button",{onClick:()=>v(s),className:"btn btn-sm btn-error",children:[e.jsx(I,{className:"h-4 w-4"}),"Supprimer"]})]}),s.statut==="encours"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>x(s,"termine"),className:"btn btn-sm btn-success",children:[e.jsx(B,{className:"h-4 w-4"}),"Terminer"]}),e.jsxs("button",{onClick:()=>x(s,"annule"),className:"btn btn-sm btn-error",children:[e.jsx(T,{className:"h-4 w-4"}),"Annuler"]})]})]})})]},s.id)),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-4",children:"Aucun inventaire trouvé"})})]})]})})}),e.jsxs("dialog",{id:"create_modal",className:"modal",children:[e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Nouvel inventaire"}),e.jsx("div",{className:"divider"}),e.jsxs("form",{onSubmit:s=>b(s,!1),children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Référence*"})}),e.jsx("input",{type:"text",name:"reference",className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control mt-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Date de l'inventaire*"})}),e.jsx("input",{type:"date",name:"date_inventaire",defaultValue:new Date().toISOString().split("T")[0],className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control mt-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Notes"})}),e.jsx("textarea",{name:"notes",className:"textarea textarea-bordered h-24"})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"button",onClick:()=>document.getElementById("create_modal").close(),className:"btn btn-ghost",children:"Annuler"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Créer"})]})]})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{children:"close"})})]}),c&&e.jsxs("dialog",{id:"edit_modal",className:"modal",children:[e.jsxs("div",{className:"modal-box",children:[e.jsxs("h3",{className:"font-bold text-lg",children:["Modifier l'inventaire ",c.reference]}),e.jsx("div",{className:"divider"}),e.jsxs("form",{onSubmit:s=>b(s,!0),children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Référence*"})}),e.jsx("input",{type:"text",name:"reference",defaultValue:c.reference,className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control mt-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Date de l'inventaire*"})}),e.jsx("input",{type:"date",name:"date_inventaire",defaultValue:(f=c.date_inventaire)==null?void 0:f.split("T")[0],className:"input input-bordered w-full",required:!0})]}),e.jsxs("div",{className:"form-control mt-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Notes"})}),e.jsx("textarea",{name:"notes",defaultValue:c.notes||"",className:"textarea textarea-bordered h-24"})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"button",onClick:()=>{document.getElementById("edit_modal").close(),d(null)},className:"btn btn-ghost",children:"Annuler"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Enregistrer"})]})]})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:()=>d(null),children:"close"})})]}),p&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Confirmer la suppression"}),e.jsxs("p",{className:"py-4",children:[`Êtes-vous sûr de vouloir supprimer l'inventaire "`,o==null?void 0:o.reference,'" ? Cette action est irréversible.']}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{onClick:()=>h(!1),className:"btn btn-ghost",children:"Annuler"}),e.jsx("button",{onClick:g,className:"btn btn-error",children:"Supprimer"})]})]})})]})]})}export{U as default};
